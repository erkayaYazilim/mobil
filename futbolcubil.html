<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Oyuncu Tahmin • Yönetim Paneli</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
:root {
  --bg: #FFFFFF;
  --surface: #E8F5E9;
  --accent: #4CAF50;
  --danger: #F44336;
  --txt: #212121;
  --txt-sub: #616161;
}
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  font-family: 'Inter', sans-serif;
}
body {
  background: var(--bg);
  color: var(--txt);
  padding: 24px;
}
h1 {
  font-size: 28px;
  margin-bottom: 12px;
}
input[type="text"],
input[type="file"] {
  width: 100%;
  padding: 10px;
  margin: 6px 0 12px;
  border: none;
  border-radius: 6px;
  background: var(--surface);
  color: var(--txt);
}
button {
  padding: 10px 16px;
  border: none;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  transition: .15s;
}
#save {
  background: var(--accent);
  color: #fff;
}
#save:disabled {
  opacity: .5;
  cursor: wait;
}
.card {
  display: flex;
  align-items: center;
  gap: 14px;
  background: var(--surface);
  padding: 10px;
  border-radius: 8px;
  margin: 8px 0;
}
.card img {
  width: 56px;
  height: 56px;
  object-fit: cover;
  border-radius: 50%;
}
.card .names {
  flex: 1;
}
.card .names span {
  display: block;
}
.card .names .c {
  font-weight: 600;
}
.card .names .w {
  color: var(--txt-sub);
  font-size: 14px;
}
.card button {
  background: var(--danger);
  color: #fff;
}
#msg {
  margin-top: 8px;
  min-height: 20px;
  color: var(--danger);
}
nav a {
  margin-right: 12px;
  color: var(--accent);
  text-decoration: none;
}
nav a:hover {
  text-decoration: underline;
}
</style>
</head>
<body>

<h1>Oyuncu Tahmin – Soru Yükle</h1>
<nav>
  <a href="main.html">Ana Sayfa</a>
  <a href="question.html">Soru Yükle</a>
  <a href="approve.html">Blog Onay Paneli</a>
  <a href="upload.html">Blog Yükle</a>
  <a href="editQuestions.html">Soru Düzenle</a>
  <a href="blockedUsers.html">Engellenenler</a>
  <a href="odulYukle.html">Ödül Yükle</a>
  <a href="odulDuzenle.html">Ödülleri Düzenle</a>
  <a href="odulAlanlar.html">Ödül Alanlar</a>
  <a href="#" onclick="showNotificationForm()"><i class="fas fa-bell"></i> Bildirim Gönder</a>
  <a href="yastahmin.html">Yaş Oyunu</a>
  <a href="transfertahmin.html">Transfer Oyunu</a>
  <a href="puzlle.html">Puzzle Oyunu</a>
  <a href="futbolcubil.html">Futbolcu Bil</a>
  <a href="#" onclick="logout()">Çıkış Yap</a>
</nav>

<input type="text" id="correct" placeholder="Doğru futbolcu adı">
<input type="text" id="wrong"   placeholder="Yanlış isim (distractor)">
<input type="file" id="photo"   accept="image/*">
<button id="save">Kaydet</button>
<div id="msg"></div>

<hr style="margin:24px 0">
<h2>Mevcut Kayıtlar</h2>
<div id="list"></div>

<!-- ░░ Firebase – ES Modules ░░ -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-storage.js";

const firebaseConfig = {
    apiKey: "AIzaSyDbxMYDAd2AI1riU9kcPG6K2LT_lB1TR8s",
    authDomain: "futbolmobil-7be36.firebaseapp.com",
    databaseURL: "https://futbolmobil-7be36-default-rtdb.firebaseio.com",
    projectId: "futbolmobil-7be36",
    storageBucket: "futbolmobil-7be36.appspot.com",
    messagingSenderId: "311578958726",
    appId: "1:311578958726:web:61866a189b73ba95af2a07",
    measurementId: "G-5837EDDD26"
};

const app  = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db   = getDatabase(app);
const st   = getStorage(app);

signInWithEmailAndPassword(auth, "admin@example.com", "123456")
  .catch(e => alert("Giriş hatası: " + e.message));

const cEl  = document.getElementById('correct'),
      wEl  = document.getElementById('wrong'),
      pEl  = document.getElementById('photo'),
      sBtn = document.getElementById('save'),
      msg  = document.getElementById('msg'),
      list = document.getElementById('list');

// Görsel sıkıştırma fonksiyonu
async function compressImage(file) {
  return new Promise((resolve, reject) => {
    const img = new Image();
    img.onload = () => {
      const canvas = document.createElement('canvas');
      canvas.width = img.width;
      canvas.height = img.height;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0);
      canvas.toBlob(blob => {
        if (blob) resolve(blob);
        else reject(new Error('Blob oluşmadı'));
      }, 'image/jpeg', 0.2); // kalite %20
    };
    img.onerror = e => reject(e);
    img.src = URL.createObjectURL(file);
  });
}

sBtn.onclick = async () => {
  const correct = cEl.value.trim(),
        wrong   = wEl.value.trim(),
        file    = pEl.files[0];
  if(!correct || !wrong || !file) { flash('Tüm alanlar zorunlu'); return; }
  sBtn.disabled = true;
  flash('Yükleniyor…');

  try {
    const id   = push(ref(db, 'oyuncutahmin')).key;
    const blob = await compressImage(file);
    const path = sRef(st, `oyuncutahmin/${id}.${file.name.split('.').pop()}`);
    await uploadBytes(path, blob);
    const url  = await getDownloadURL(path);

    await set(ref(db, `oyuncutahmin/${id}`), {
      correctName: correct,
      wrongName:   wrong,
      photoUrl:    url
    });

    flash('✅ Eklendi');
    cEl.value = '';
    wEl.value = '';
    pEl.value = '';
  } catch(e) {
    flash('Hata: ' + e.message);
  }
  sBtn.disabled = false;
};

onValue(ref(db, 'oyuncutahmin'), snap => {
  list.innerHTML = '';
  snap.forEach(cs => {
    const o = cs.val();
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <img src="${o.photoUrl}" alt="Futbolcu">
      <div class="names">
        <span class="c">${o.correctName}</span>
        <span class="w">Yanlış: ${o.wrongName}</span>
      </div>
      <button data-id="${cs.key}">Sil</button>
    `;
    card.querySelector('button').onclick = ev => {
      if(confirm('Silinsin mi?'))
        remove(ref(db, 'oyuncutahmin/' + ev.target.dataset.id));
    };
    list.appendChild(card);
  });
});

function flash(t) {
  msg.textContent = t;
  setTimeout(() => msg.textContent = '', 3500);
}
</script>
</body>
</html>
